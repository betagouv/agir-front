root /app/dist;

set $SCRIPT "script-src 'self' 'unsafe-inline' stats.beta.gouv.fr";
set $STYLE "style-src 'self' 'unsafe-inline'";
set $IMG "img-src 'self' data: blob: res.cloudinary.com images.unsplash.com fastly.picsum.photos";
set $FONT "font-src 'self' data:";
set $DEFAULT "default-src 'self'";
set $CONNECT "connect-src 'self' <%= ENV['VITE_API_URL'] %> <%= URI.parse(ENV['VITE_API_URL_CMS']).hostname %> <%= ENV['VITE_MATOMO_URL'] %>";
set $FRAME "frame-src 'self' www.youtube.com";

location / {
  try_files $uri $uri/ /index.html =404;
  add_header X-Frame-Options SAMEORIGIN;
  add_header X-Content-Type-Options nosniff;
  add_header X-XSS-Protection "1; mode=block";
  add_header Content-Security-Policy "${SCRIPT}; ${STYLE}; ${IMG}; ${FONT}; ${DEFAULT}; ${CONNECT}; ${FRAME}";
}